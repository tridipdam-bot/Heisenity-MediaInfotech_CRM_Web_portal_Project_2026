generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model Admin {
  id                  String               @id @default(cuid())
  adminId             String               @unique
  name                String
  email               String               @unique
  password            String
  phone               String?
  status              String               @default("ACTIVE")
  createdAt           DateTime             @default(now())
  updatedAt           DateTime             @updatedAt
  adminOverrides      AttendanceOverride[]
  assignedTeamLeaders Employee[]           @relation("AdminAssignedTeamLeaders")
  sessions            UserSession[]
  organizedMeetings   Meeting[]            @relation("MeetingOrganizerAdmin")

  @@map("admins")
}

model Team {
  id              String          @id @default(cuid())
  name            String          @unique
  description     String?
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
  members         Employee[]
  support_tickets SupportTicket[]

  @@map("teams")
}

model Employee {
  id                      String                   @id @default(cuid())
  name                    String
  employeeId              String                   @unique
  email                   String                   @unique
  password                String
  phone                   String?
  role                    EmployeeRole             @default(FIELD_ENGINEER)
  status                  String                   @default("ACTIVE")
  sickLeaveBalance        Int                      @default(12)
  casualLeaveBalance      Int                      @default(12)
  salary                  Decimal?                 @db.Decimal(10, 2)
  address                 String?
  aadharCard              String?                  @unique
  panCard                 String?                  @unique
  uanNumber               String?
  esiNumber               String?
  bankAccountNumber       String?
  createdAt               DateTime                 @default(now())
  updatedAt               DateTime                 @updatedAt
  /// *
  ///    * ---------- FE specific (optional) ----------
  teamId                  String?
  isTeamLeader            Boolean                  @default(false)
  assignedBy              String?
  attendanceOverrides     AttendanceOverride[]
  attendances             Attendance[]
  acceptedSupportRequests CustomerSupportRequest[]
  documents               EmployeeDocument[]
  assignedAdmin           Admin?                   @relation("AdminAssignedTeamLeaders", fields: [assignedBy], references: [id])
  team                    Team?                    @relation(fields: [teamId], references: [id])
  leaveApplications       LeaveApplication[]
  payrollRecords          PayrollRecord[]
  petrolBills             PetrolBill[]
  featureAccess           StaffFeatureAccess[]
  assignedTickets         SupportTicket[]          @relation("TicketAssignee")
  reportedTickets         SupportTicket[]          @relation("TicketReporter")
  tasks                   Task[]
  ticketAttachments       TicketAttachment[]
  ticketComments          TicketComment[]
  ticketHistory           TicketHistory[]
  sessions                UserSession[]
  assignedVehicle         Vehicle?
  inventoryTransactions   InventoryTransaction[]
  allocations             Allocation[]
  barcodeCheckouts        BarcodeCheckout[]
  
  // Meeting relations
  organizedMeetings       Meeting[]                @relation("MeetingOrganizerEmployee")
  meetingAttendances      MeetingAttendee[]        @relation("MeetingAttendees")
  assignedMeetingTasks    MeetingTask[]            @relation("MeetingTaskAssignee")

  @@index([teamId])
  @@index([assignedBy])
  @@map("employees")
}

model Attendance {
  id               String                   @id @default(cuid())
  date             DateTime                 @db.Date
  clockIn          DateTime?
  clockOut         DateTime?
  status           AttendanceStatus         @default(PRESENT)
  location         String?
  latitude         Decimal?                 @db.Decimal(10, 8)
  longitude        Decimal?                 @db.Decimal(11, 8)
  ipAddress        String?
  createdAt        DateTime                 @default(now())
  updatedAt        DateTime                 @updatedAt
  attemptCount     AttemptCount             @default(ZERO)
  deviceInfo       String?
  locked           Boolean                  @default(false)
  lockedReason     String?
  photo            String?
  source           AttendanceSource         @default(SELF)
  approvalStatus   AttendanceApprovalStatus @default(PENDING)
  approvedBy       String?
  approvedAt       DateTime?
  rejectedBy       String?
  rejectedAt       DateTime?
  approvalReason   String?
  employeeId       String
  pendingCheckInAt DateTime?
  employee         Employee                 @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  sessions AttendanceSession[]

  @@unique([employeeId, date])
  @@index([date])
  @@index([status])
  @@index([approvalStatus])
  @@map("attendances")
}

model AttendanceSession {
  id           String    @id @default(cuid())
  attendanceId String
  clockIn      DateTime
  clockOut     DateTime?
  photo        String?
  location     String?
  ipAddress    String?
  deviceInfo   String?
  createdAt    DateTime  @default(now())

  attendance Attendance @relation(fields: [attendanceId], references: [id], onDelete: Cascade)

  @@index([attendanceId])
  @@index([clockIn])
  @@map("attendance_sessions")
}

model AttendanceOverride {
  id         String           @id @default(cuid())
  employeeId String
  date       DateTime         @db.Date
  adminId    String
  oldStatus  AttendanceStatus
  newStatus  AttendanceStatus
  reason     String
  timestamp  DateTime         @default(now())
  admin      Admin            @relation(fields: [adminId], references: [id], onDelete: Cascade)
  employee   Employee         @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  @@index([employeeId])
  @@index([adminId])
  @@index([date])
  @@map("attendance_overrides")
}

model Task {
  id              String     @id @default(cuid())
  employeeId      String
  title           String
  description     String
  category        String?
  location        String?
  assignedBy      String
  assignedAt      DateTime   @default(now())
  status          TaskStatus @default(PENDING)
  createdAt       DateTime   @default(now())
  updatedAt       DateTime   @updatedAt
  checkIn         DateTime?
  checkOut        DateTime?
  relatedTicketId String?
  employee        Employee   @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  @@index([employeeId])
  @@index([assignedAt])
  @@index([status])
  @@index([relatedTicketId])
  @@map("tasks")
}

model UserSession {
  id           String    @id @default(cuid())
  sessionToken String    @unique
  adminId      String?
  employeeId   String?
  userType     UserType
  deviceInfo   String?
  ipAddress    String?
  isActive     Boolean   @default(true)
  lastActivity DateTime  @default(now())
  createdAt    DateTime  @default(now())
  expiresAt    DateTime
  admin        Admin?    @relation(fields: [adminId], references: [id], onDelete: Cascade)
  employee     Employee? @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  @@index([adminId])
  @@index([employeeId])
  @@index([sessionToken])
  @@index([isActive])
  @@map("user_sessions")
}

model Vehicle {
  id            String        @id @default(cuid())
  vehicleNumber String        @unique
  make          String
  model         String
  year          Int?
  type          VehicleType   @default(CAR)
  status        VehicleStatus @default(AVAILABLE)
  assignedTo    String?       @unique
  assignedAt    DateTime?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  petrolBills   PetrolBill[]
  employee      Employee?     @relation(fields: [assignedTo], references: [id])

  @@index([assignedTo])
  @@index([status])
  @@map("vehicles")
}

model PetrolBill {
  id          String     @id @default(cuid())
  vehicleId   String
  employeeId  String
  amount      Decimal    @db.Decimal(10, 2)
  date        DateTime   @db.Date
  imageUrl    String?
  description String?
  status      BillStatus @default(PENDING)
  approvedBy  String?
  approvedAt  DateTime?
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  employee    Employee   @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  vehicle     Vehicle    @relation(fields: [vehicleId], references: [id], onDelete: Cascade)

  @@index([vehicleId])
  @@index([employeeId])
  @@index([date])
  @@index([status])
  @@map("petrol_bills")
}

model PayrollRecord {
  id          String        @id @default(cuid())
  employeeId  String
  month       Int
  year        Int
  basicSalary Decimal       @db.Decimal(10, 2)
  allowances  Decimal       @default(0) @db.Decimal(10, 2)
  deductions  Decimal       @default(0) @db.Decimal(10, 2)
  overtime    Decimal       @default(0) @db.Decimal(10, 2)
  netSalary   Decimal       @db.Decimal(10, 2)
  status      PayrollStatus @default(DRAFT)
  processedBy String?
  processedAt DateTime?

  // Detailed breakdown fields
  daysPaid            Int?     @default(30)
  uanNumber           String?
  esiNumber           String?
  bankAccountNumber   String?
  houseRentAllowance  Decimal? @default(0) @db.Decimal(10, 2)
  skillAllowance      Decimal? @default(0) @db.Decimal(10, 2)
  conveyanceAllowance Decimal? @default(0) @db.Decimal(10, 2)
  medicalAllowance    Decimal? @default(0) @db.Decimal(10, 2)
  professionalTax     Decimal? @default(0) @db.Decimal(10, 2)
  providentFund       Decimal? @default(0) @db.Decimal(10, 2)
  esi                 Decimal? @default(0) @db.Decimal(10, 2)
  incomeTax           Decimal? @default(0) @db.Decimal(10, 2)
  personalLoan        Decimal? @default(0) @db.Decimal(10, 2)
  otherAdvance        Decimal? @default(0) @db.Decimal(10, 2)
  medicalExp          Decimal? @default(0) @db.Decimal(10, 2)
  lta                 Decimal? @default(0) @db.Decimal(10, 2)
  repairMaintenance   Decimal? @default(0) @db.Decimal(10, 2)
  fuelExp             Decimal? @default(0) @db.Decimal(10, 2)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  employee  Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  @@unique([employeeId, month, year])
  @@index([employeeId])
  @@index([month, year])
  @@index([status])
  @@map("payroll_records")
}

model AdminNotification {
  id        String                @id @default(cuid())
  type      AdminNotificationType
  title     String
  message   String
  data      String?
  isRead    Boolean               @default(false)
  createdAt DateTime              @default(now())
  updatedAt DateTime              @updatedAt

  @@index([isRead])
  @@index([type])
  @@index([createdAt])
  @@map("admin_notifications")
}

model EmployeeDocument {
  id          String   @id @default(cuid())
  employeeId  String
  title       String
  description String?
  fileName    String
  filePath    String
  fileSize    Int
  mimeType    String
  uploadedBy  String
  uploadedAt  DateTime @default(now())
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  employee    Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  @@index([employeeId])
  @@index([uploadedAt])
  @@map("employee_documents")
}

model LeaveApplication {
  id         String      @id @default(cuid())
  employeeId String
  leaveType  LeaveType
  startDate  DateTime    @db.Date
  endDate    DateTime    @db.Date
  reason     String
  status     LeaveStatus @default(PENDING)
  appliedAt  DateTime    @default(now())
  reviewedBy String?
  reviewedAt DateTime?
  reviewNote String?
  createdAt  DateTime    @default(now())
  updatedAt  DateTime    @updatedAt
  employee   Employee    @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  @@index([employeeId])
  @@index([status])
  @@index([startDate])
  @@index([appliedAt])
  @@map("leave_applications")
}

model SystemConfiguration {
  id        String   @id @default(cuid())
  key       String   @unique
  value     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("system_configurations")
}

model Project {
  id          String           @id @default(cuid())
  name        String
  startDate   DateTime         @db.Date
  status      ProjectStatus    @default(ONGOING)
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt
  description String?
  endDate     DateTime?        @db.Date
  priority    ProjectPriority  @default(MEDIUM)
  budget      Decimal?         @db.Decimal(12, 2)
  progress    Int?             @default(0)
  customerId  String?
  customer    Customer?        @relation("CustomerProjects", fields: [customerId], references: [id])
  payments    ProjectPayment[]
  products    ProjectProduct[]
  updates     ProjectUpdate[]

  @@index([customerId])
  @@map("projects")
}

model ProjectUpdate {
  id           String   @id @default(cuid())
  projectId    String
  update       String
  issues       String?
  pendingTasks String?
  workProgress String?
  updatedBy    String?
  attachments  String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  project      Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([projectId])
  @@map("project_updates")
}

model ProjectPayment {
  id                 String   @id @default(cuid())
  projectId          String
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
  pendingPayment     Decimal? @db.Decimal(10, 2)
  receivedPayment    Decimal? @db.Decimal(10, 2)
  totalContractValue Decimal? @db.Decimal(10, 2)
  project            Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([projectId])
  @@map("project_payments")
}

model ProjectProduct {
  id        String   @id @default(cuid())
  projectId String
  name      String
  category  String?
  vendor    String?
  notes     String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  project   Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([projectId])
  @@map("project_products")
}

model SupportTicket {
  id                     String                  @id @default(cuid())
  ticketId               String                  @unique
  description            String
  categoryId             String
  priority               TicketPriority
  status                 TicketStatus            @default(OPEN)
  assigneeId             String?
  reporterId             String?
  dueDate                DateTime?               @db.Date
  estimatedHours         Decimal?                @db.Decimal(5, 2)
  tags                   String?
  createdAt              DateTime                @default(now())
  updatedAt              DateTime                @updatedAt
  resolvedAt             DateTime?
  closedAt               DateTime?
  customerId             String?
  customerName           String?
  customerPhone          String?
  assignedTeamId         String?
  customerSupportRequest CustomerSupportRequest?
  category               TicketCategory          @relation(fields: [categoryId], references: [id])
  teams                  Team?                   @relation(fields: [assignedTeamId], references: [id])
  assignee               Employee?               @relation("TicketAssignee", fields: [assigneeId], references: [id])
  reporter               Employee?               @relation("TicketReporter", fields: [reporterId], references: [id])
  attachments            TicketAttachment[]
  comments               TicketComment[]
  history                TicketHistory[]

  @@index([assigneeId])
  @@index([reporterId])
  @@index([status])
  @@index([priority])
  @@index([categoryId])
  @@index([createdAt])
  @@index([assignedTeamId])
  @@map("support_tickets")
}

model TicketComment {
  id         String        @id @default(cuid())
  ticketId   String
  authorId   String
  content    String
  isInternal Boolean       @default(false)
  createdAt  DateTime      @default(now())
  updatedAt  DateTime      @updatedAt
  author     Employee      @relation(fields: [authorId], references: [id], onDelete: Cascade)
  ticket     SupportTicket @relation(fields: [ticketId], references: [id], onDelete: Cascade)

  @@index([ticketId])
  @@index([authorId])
  @@index([createdAt])
  @@map("ticket_comments")
}

model TicketAttachment {
  id         String        @id @default(cuid())
  ticketId   String
  fileName   String
  filePath   String
  fileSize   Int
  mimeType   String
  uploadedBy String
  uploadedAt DateTime      @default(now())
  ticket     SupportTicket @relation(fields: [ticketId], references: [id], onDelete: Cascade)
  uploader   Employee      @relation(fields: [uploadedBy], references: [id], onDelete: Cascade)

  @@index([ticketId])
  @@index([uploadedBy])
  @@map("ticket_attachments")
}

model TicketHistory {
  id        String              @id @default(cuid())
  ticketId  String
  action    TicketHistoryAction
  field     String?
  oldValue  String?
  newValue  String?
  changedBy String
  timestamp DateTime            @default(now())
  user      Employee            @relation(fields: [changedBy], references: [id], onDelete: Cascade)
  ticket    SupportTicket       @relation(fields: [ticketId], references: [id], onDelete: Cascade)

  @@index([ticketId])
  @@index([changedBy])
  @@index([timestamp])
  @@map("ticket_history")
}

model Tender {
  id                String           @id @default(cuid())
  tenderNumber      String           @unique
  name              String
  description       String?
  department        String
  projectMapping    String?
  tenderType        TenderType
  submissionDate    DateTime         @db.Date
  deadline          DateTime         @db.Date
  status            TenderStatus     @default(SUBMITTED)
  totalValue        Decimal?         @db.Decimal(15, 2)
  requiredDocuments String?
  totalEMDInvested  Decimal?         @db.Decimal(15, 2)
  totalEMDRefunded  Decimal?         @db.Decimal(15, 2)
  totalEMDForfeited Decimal?         @db.Decimal(15, 2)
  createdBy         String
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @updatedAt
  approvedBy        String?
  approvedAt        DateTime?
  rejectedBy        String?
  rejectedAt        DateTime?
  closedAt          DateTime?
  internalRemarks   String?
  auditLogs         TenderAuditLog[]
  documents         TenderDocument[]
  emdRecords        TenderEMD[]

  @@index([status])
  @@index([submissionDate])
  @@index([deadline])
  @@index([department])
  @@index([tenderType])
  @@map("tenders")
}

model TenderDocument {
  id           String             @id @default(cuid())
  tenderId     String
  fileName     String
  originalName String
  filePath     String
  fileSize     Int
  mimeType     String
  documentType TenderDocumentType
  isRequired   Boolean            @default(false)
  status       DocumentStatus     @default(PENDING)
  uploadedBy   String
  uploadedAt   DateTime           @default(now())
  verifiedBy   String?
  verifiedAt   DateTime?
  remarks      String?
  tender       Tender             @relation(fields: [tenderId], references: [id], onDelete: Cascade)

  @@index([tenderId])
  @@index([documentType])
  @@index([status])
  @@map("tender_documents")
}

model TenderEMD {
  id          String    @id @default(cuid())
  tenderId    String
  amount      Decimal   @db.Decimal(15, 2)
  status      EMDStatus @default(INVESTED)
  investedAt  DateTime  @default(now())
  refundedAt  DateTime?
  forfeitedAt DateTime?
  remarks     String?
  createdBy   String
  updatedBy   String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  tender      Tender    @relation(fields: [tenderId], references: [id], onDelete: Cascade)

  @@index([tenderId])
  @@index([status])
  @@map("tender_emd")
}

model TenderAuditLog {
  id          String            @id @default(cuid())
  tenderId    String
  action      TenderAuditAction
  field       String?
  oldValue    String?
  newValue    String?
  remarks     String?
  performedBy String
  timestamp   DateTime          @default(now())
  tender      Tender            @relation(fields: [tenderId], references: [id], onDelete: Cascade)

  @@index([tenderId])
  @@index([performedBy])
  @@index([timestamp])
  @@index([action])
  @@map("tender_audit_logs")
}

model StaffFeatureAccess {
  id         String             @id @default(cuid())
  employeeId String
  feature    StaffPortalFeature
  isAllowed  Boolean            @default(true)
  grantedBy  String?
  grantedAt  DateTime           @default(now())
  updatedBy  String?
  updatedAt  DateTime           @updatedAt
  employee   Employee           @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  @@unique([employeeId, feature])
  @@index([employeeId])
  @@index([feature])
  @@map("staff_feature_access")
}

model CustomerSupportRequest {
  id                 String                @id @default(cuid())
  customerId         String
  message            String
  documents          String?
  status             CustomerSupportStatus @default(PENDING)
  acceptedBy         String?
  ticketId           String?               @unique
  createdAt          DateTime              @default(now())
  updatedAt          DateTime              @updatedAt
  acceptedByEmployee Employee?             @relation(fields: [acceptedBy], references: [id])
  customer           Customer              @relation(fields: [customerId], references: [id], onDelete: Cascade)
  ticket             SupportTicket?        @relation(fields: [ticketId], references: [id])

  @@index([customerId])
  @@index([acceptedBy])
  @@index([status])
  @@map("customer_support_requests")
}

model Customer {
  id              String                   @id @default(cuid())
  customerId      String                   @unique
  name            String
  phone           String                   @unique
  email           String?
  address         String?
  status          String                   @default("ACTIVE")
  createdBy       String
  createdAt       DateTime                 @default(now())
  updatedAt       DateTime                 @updatedAt
  sessions        CustomerSession[]
  supportRequests CustomerSupportRequest[]
  projects        Project[]                @relation("CustomerProjects")
  meetings        Meeting[]

  @@index([customerId])
  @@index([phone])
  @@index([status])
  @@map("customers")
}

model CustomerSession {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  customerId   String
  deviceInfo   String?
  ipAddress    String?
  isActive     Boolean  @default(true)
  lastActivity DateTime @default(now())
  createdAt    DateTime @default(now())
  expiresAt    DateTime
  customer     Customer @relation(fields: [customerId], references: [id], onDelete: Cascade)

  @@index([customerId])
  @@index([sessionToken])
  @@index([isActive])
  @@map("customer_sessions")
}

enum EmployeeRole {
  FIELD_ENGINEER
  IN_OFFICE
}

enum AttendanceStatus {
  PRESENT
  ABSENT
  LATE
  MARKDOWN
}

enum AttendanceSource {
  SELF
  ADMIN
}

enum TaskStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum AttemptCount {
  ZERO
  ONE
  TWO
  THREE
}

enum AttendanceApprovalStatus {
  PENDING
  APPROVED
  REJECTED
  NOT_REQUIRED
}

enum UserType {
  ADMIN
  EMPLOYEE
}

enum VehicleType {
  CAR
  BIKE
  TRUCK
  VAN
}

enum VehicleStatus {
  AVAILABLE
  ASSIGNED
}

enum BillStatus {
  PENDING
  APPROVED
  REJECTED
}

enum PayrollStatus {
  DRAFT
  PROCESSED
  PAID
}

enum AdminNotificationType {
  VEHICLE_UNASSIGNED
  TASK_COMPLETED
  ATTENDANCE_ALERT
  ATTENDANCE_APPROVAL_REQUEST
  ATTENDANCE_APPROVED
  ATTENDANCE_REJECTED
  TICKET_CREATED
  TICKET_ASSIGNED
}

enum LeaveType {
  SICK_LEAVE
  CASUAL_LEAVE
  ANNUAL_LEAVE
  EMERGENCY_LEAVE
  MATERNITY_LEAVE
  PATERNITY_LEAVE
  OTHER
}

enum LeaveStatus {
  PENDING
  APPROVED
  REJECTED
  CANCELLED
}

enum ProjectStatus {
  ONGOING
  COMPLETED
  ON_HOLD
}

enum ProjectPriority {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}

enum PaymentStatus {
  FULLY_PAID
  PARTIALLY_PAID
  FULL_DUE
}

model TicketCategory {
  id          String          @id @default(cuid())
  name        String          @unique
  description String?
  isActive    Boolean         @default(true)
  createdBy   String?
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt
  tickets     SupportTicket[]

  @@map("ticket_categories")
}

enum TicketPriority {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}

enum TicketStatus {
  OPEN
  RESOLVED
  CLOSED
}

enum TicketHistoryAction {
  CREATED
  UPDATED
  ASSIGNED
  STATUS_CHANGED
  PRIORITY_CHANGED
  COMMENTED
  RESOLVED
  CLOSED
  REOPENED
}

enum TenderType {
  OPEN
  LIMITED
  SINGLE_SOURCE
  EMERGENCY
  FRAMEWORK
  OTHER
}

enum TenderStatus {
  ACCEPTED
  REJECTED
  DRAFT
  SUBMITTED
}

enum TenderDocumentType {
  TECHNICAL_SPECIFICATION
  FINANCIAL_PROPOSAL
  COMPANY_PROFILE
  COMPLIANCE_CERTIFICATE
  EMD_PROOF
  TENDER_FORM
  OTHER
}

enum DocumentStatus {
  PENDING
  VERIFIED
  REJECTED
}

enum EMDStatus {
  INVESTED
  REFUNDED
  FORFEITED
}

enum TenderAuditAction {
  CREATED
  UPDATED
  SUBMITTED
  APPROVED
  REJECTED
  AWARDED
  NOT_AWARDED
  CLOSED
  DOCUMENT_UPLOADED
  DOCUMENT_VERIFIED
  DOCUMENT_REJECTED
  EMD_INVESTED
  EMD_REFUNDED
  EMD_FORFEITED
  STATUS_CHANGED
}

enum StaffPortalFeature {
  DASHBOARD
  PROJECT
  TASK_MANAGEMENT
  PAYROLL
  VEHICLE
  CUSTOMERS
  TEAMS
  TENDERS
  STOCK
  LEAVE_MANAGEMENT
  FIELD_ENGINEER_ATTENDANCE
  INOFFICE_ATTENDANCE
  CUSTOMER_SUPPORT_REQUESTS
  STAFF_FEATURE_ACCESS
}

enum CustomerSupportStatus {
  PENDING
  ACCEPTED
  TICKET_CREATED
  CANCELLED
}

/////////////////////////////////
///                          ////
/// STOCK MANAGEMENT SCHEMAS ///
/// STOCK MANAGEMENT SCHEMAS ///
///                          ////
/////////////////////////////////

enum BarcodeStatus {
  AVAILABLE
  CHECKED_OUT
  RETIRED
}

enum TransactionType {
  CHECKOUT
  RETURN
  ADJUST
}

//////////////////////////
// PRODUCTS
//////////////////////////

model Product {
  id               BigInt   @id @default(autoincrement())
  sku              String   @unique
  productName      String   @map("product_name")
  description      String?
  boxQty           Int      @map("box_qty")
  totalUnits       Int      @map("total_units")
  reorderThreshold Int      @default(0) @map("reorder_threshold")
  isActive         Boolean  @default(true) @map("is_active")
  createdAt        DateTime @default(now()) @map("created_at")
  updatedAt        DateTime @updatedAt @map("updated_at")

  barcodes       Barcode[]
  transactions   InventoryTransaction[]
  allocations    Allocation[]
  lowStockAlerts LowStockAlert[]

  @@map("products")
}

//////////////////////////
// BARCODES (PER BOX)
//////////////////////////

model Barcode {
  id           BigInt        @id @default(autoincrement())
  barcodeValue String        @unique @map("barcode_value")
  serialNumber String        @unique @map("serial_number")
  boxQty       Int           @map("box_qty")
  status       BarcodeStatus @default(AVAILABLE)
  createdAt    DateTime      @default(now()) @map("created_at")

  productId BigInt
  product   Product @relation(fields: [productId], references: [id])

  transactions InventoryTransaction[]
  checkouts    BarcodeCheckout[]

  @@index([barcodeValue])
  @@map("barcodes")
}

//////////////////////////
// INVENTORY TRANSACTIONS (IMMUTABLE)
//////////////////////////

model InventoryTransaction {
  id              BigInt          @id @default(autoincrement())
  transactionType TransactionType @map("transaction_type")
  checkoutQty     Int             @default(0) @map("checkout_qty")
  returnedQty     Int             @default(0) @map("returned_qty")
  usedQty         Int             @default(0) @map("used_qty")
  remarks         String?
  createdAt       DateTime        @default(now()) @map("created_at")

  barcodeId  BigInt
  productId  BigInt
  employeeId String

  barcode  Barcode  @relation(fields: [barcodeId], references: [id])
  product  Product  @relation(fields: [productId], references: [id])
  employee Employee @relation(fields: [employeeId], references: [id])

  @@index([employeeId])
  @@index([productId])
  @@map("inventory_transactions")
}

//////////////////////////
// ALLOCATIONS (WHO HAS WHAT NOW)
//////////////////////////

model Allocation {
  id             BigInt   @id @default(autoincrement())
  allocatedUnits Int      @map("allocated_units")
  updatedAt      DateTime @default(now()) @map("updated_at")

  employeeId String
  productId  BigInt

  employee Employee @relation(fields: [employeeId], references: [id])
  product  Product  @relation(fields: [productId], references: [id])

  @@unique([employeeId, productId])
  @@index([employeeId])
  @@index([productId])
  @@map("allocations")
}

//////////////////////////
// BARCODE CHECKOUTS (PER BOX TRACKING)
//////////////////////////

model BarcodeCheckout {
  id           BigInt    @id @default(autoincrement())
  checkoutTime DateTime  @default(now()) @map("checkout_time")
  isReturned   Boolean   @default(false) @map("is_returned")
  returnTime   DateTime? @map("return_time")

  barcodeId  BigInt
  employeeId String

  barcode  Barcode  @relation(fields: [barcodeId], references: [id])
  employee Employee @relation(fields: [employeeId], references: [id])

  @@map("barcode_checkouts")
}

//////////////////////////
// LOW STOCK ALERT LOG
//////////////////////////

model LowStockAlert {
  id             BigInt   @id @default(autoincrement())
  stockAtTrigger Int      @map("stock_at_trigger")
  triggeredAt    DateTime @default(now()) @map("triggered_at")

  productId BigInt
  product   Product @relation(fields: [productId], references: [id])

  @@map("low_stock_alerts")
}

//////////////////////////
// MEETINGS MANAGEMENT
//////////////////////////

model Meeting {
  id          String        @id @default(cuid())
  title       String
  description String?
  startTime   DateTime
  endTime     DateTime
  location    String?
  meetingType MeetingType   @default(INTERNAL)
  status      MeetingStatus @default(SCHEDULED)
  priority    MeetingPriority @default(MEDIUM)
  
  // Meeting organizer (can be either admin or employee)
  organizerAdminId    String?
  organizerEmployeeId String?
  organizerAdmin      Admin?    @relation("MeetingOrganizerAdmin", fields: [organizerAdminId], references: [id])
  organizerEmployee   Employee? @relation("MeetingOrganizerEmployee", fields: [organizerEmployeeId], references: [id])
  
  // Optional customer for external meetings
  customerId  String?
  customer    Customer? @relation(fields: [customerId], references: [id])
  
  // Meeting link for virtual meetings
  meetingLink String?
  
  // Agenda and notes
  agenda      String?
  notes       String?
  
  // Timestamps
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  // Relations
  attendees   MeetingAttendee[]
  tasks       MeetingTask[]
  calendlyMeeting CalendlyMeeting?

  @@index([organizerAdminId])
  @@index([organizerEmployeeId])
  @@index([customerId])
  @@index([startTime])
  @@index([status])
  @@map("meetings")
}

model MeetingAttendee {
  id        String            @id @default(cuid())
  meetingId String
  employeeId String
  status    AttendeeStatus    @default(INVITED)
  response  AttendeeResponse? 
  
  meeting   Meeting  @relation(fields: [meetingId], references: [id], onDelete: Cascade)
  employee  Employee @relation("MeetingAttendees", fields: [employeeId], references: [id])
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([meetingId, employeeId])
  @@index([meetingId])
  @@index([employeeId])
  @@map("meeting_attendees")
}

model MeetingTask {
  id          String     @id @default(cuid())
  meetingId   String
  title       String
  description String?
  assigneeId  String?
  dueDate     DateTime?
  status      TaskStatus @default(PENDING)
  
  meeting     Meeting   @relation(fields: [meetingId], references: [id], onDelete: Cascade)
  assignee    Employee? @relation("MeetingTaskAssignee", fields: [assigneeId], references: [id])
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([meetingId])
  @@index([assigneeId])
  @@map("meeting_tasks")
}

model CalendlyMeeting {
  id                   String   @id @default(cuid())
  meetingId            String   @unique
  calendlyEventUuid    String   @unique
  calendlyInviteeUuid  String   @unique
  inviteeName          String
  inviteeEmail         String
  inviteePhone         String?
  eventName            String
  eventDuration        Int      // in minutes
  scheduledAt          DateTime
  calendlyEventUrl     String?
  rescheduleUrl        String?
  cancelUrl            String?
  
  // Additional Calendly data
  calendlyData         Json?    // Store full Calendly payload
  syncedAt             DateTime @default(now())
  lastSyncAt           DateTime @updatedAt
  
  meeting              Meeting  @relation(fields: [meetingId], references: [id], onDelete: Cascade)
  
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt

  @@index([calendlyEventUuid])
  @@index([calendlyInviteeUuid])
  @@index([inviteeEmail])
  @@map("calendly_meetings")
}

enum MeetingType {
  INTERNAL
  CLIENT
  VENDOR
  TRAINING
  REVIEW
  OTHER
}

enum MeetingStatus {
  SCHEDULED
  IN_PROGRESS
  COMPLETED
  CANCELLED
  POSTPONED
}

enum MeetingPriority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum AttendeeStatus {
  INVITED
  CONFIRMED
  DECLINED
  TENTATIVE
  NO_RESPONSE
}

enum AttendeeResponse {
  ACCEPTED
  DECLINED
  TENTATIVE
}
